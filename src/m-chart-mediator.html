<link rel="import" href="../bower_components/polymer/polymer.html">

<link rel="import" href="m-mediator-behavior.html">
<link rel="import" href="m-chart-footer.html">
<link rel="import" href="m-chart.html">

<dom-module id="m-chart-mediator">
  <template>
    <style>
      :host {
        position: inherit;
      }
    </style>

    <m-chart days="[[days]]"></m-chart>
    <m-chart-footer today="[[today]]"></m-chart-footer>
    
  </template>

  <script>
    Polymer({

      is: 'm-chart-mediator',

      properties: {
        state: Object,

        days: Array,
        today: Number
      },

      observers: [
        'onDateStringChanged(state.datestring)',
        'onLogChanged(state.log.*)',
      ],

      onDateStringChanged: function() {
        this.today = this.state.time;
      },

      onLogChanged: function() {
        this.days = this.state.log.slice(-7)
          .map(function(ts) {
            var date = new Date(ts);
            var hourstring = date.toTimeString().split(" ")[0].slice(0, 5);
            var daystring = date.toLocaleDateString('en-US', {weekday:'short'});
            return {
              hourstring: hourstring,
              daystring: daystring,
              timestamp: ts,
            };
        });
      },

      _getTime: function(date) {        
        return date.toTimeString().split(" ")[0].slice(0, 5);
      },

    });
  </script>
</dom-module>
